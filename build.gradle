apply plugin: 'java'
apply plugin: 'war'
apply plugin: 'jetty'

tasks.withType(JavaCompile) {
  sourceCompatibility = '1.8'
  targetCompatibility = '1.8'
  options.encoding = 'UTF-8'
}

repositories {
  jcenter()
}

dependencies {
  compile 'javax:javaee-api:7.0'
  compile 'org.glassfish.jersey.core:jersey-server:2.13'
  compile 'org.glassfish.jersey.containers:jersey-container-servlet-core:2.13'
  compile 'org.eclipse.jetty:jetty-server:9.3.5.v20151012'
  providedCompile 'org.eclipse.jetty:jetty-webapp:9.3.5.v20151012'
  compile 'org.eclipse.jetty:jetty-plus:9.3.5.v20151012'
  providedCompile 'org.eclipse.jetty:jetty-annotations:9.3.5.v20151012'
}

jettyRun {
  httpPort = 8080
}

war {
  baseName = 'sample'

  from {
    configurations.providedCompile.collect {
      it.isDirectory() ? it : project.zipTree(it)
    }
  }
  from fileTree(dir: 'build/classes/main', include: '**/Main.class')

  manifest.attributes('Main-Class': 'sample.Main')
}
